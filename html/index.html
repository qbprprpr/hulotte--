<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/index.css">
</head>
<body>
    <div class="site">
        <div class="site-header">
            <div class="site-title">
                <img src="../img/logo-invisible.png" alt="logo">
            </div>
            <div class="header-menu">
                <ul class="header-menu-main">
                    <li>
                        <a href="javascript:;">Top</a>
                    </li>
                    <li>
                        <a href="javascript:;">Story</a>
                    </li>
                    <li>
                        <a href="javascript:;">Characters</a>
                    </li>
                    <li>
                        <a href="javascript:;">Graphic</a>
                    </li>
                    <li>
                        <a href="javascript:;">Download</a>
                    </li>
                    <li>
                        <a href="javascript:;">Special</a>
                    </li>
                    <li>
                        <a href="javascript:;">Diary</a>
                    </li>
                    <li>
                        <a href="javascript:;">Spec</a>
                    </li>
                </ul>
                <div class="header-menu-social"></div>
            </div>
        </div>
        <div class="site-content">
           <img class="char" id="char" src="../img/top-mainvisual-char.png" alt="">
           <img class="bg" id="bg" src="../img/top-mainvisual-bg.png" alt="">
        </div>
        <div class="article-inner" id="articleInner">
            <section class="in-view">
                <div class="in-view-title">
                    <div class="left">what's New!</div>
                    <div class="right">更新履历</div>
                </div>
                <div class="in-view-content">
                    <ul>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                    </ul>
                </div>
            </section>
            <section class="in-view">
                <div class="in-view-title">
                    <div class="left">Publish</div>
                    <div class="right">杂志掲载情报</div>
                </div>
                <div class="in-view-content">
                    <ul>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                        <li>
                            <div class="time">2021/05/24</div>
                            <div class="box">隨便給點内容</div>
                            <div class="circle"></div>
                        </li>
                    </ul>
                </div>
            </section>
        </div>

        <div class="plate" id="plate">
            <ul>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-10.jpg" alt="">
                    </a>
                </li>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-09.jpg" alt="">
                    </a>
                </li>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-08.jpg" alt="">
                    </a>
                </li>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-06.jpg" alt="">
                    </a>
                </li>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-05.jpg" alt="">
                    </a>
                </li>
                <li class="plate-delay">
                    <a href="javascript:;">
                        <img src="../img/banner-03.jpg" alt="">
                    </a>
                </li>
            </ul>
        </div>

        <!-- story简介 -->
        <div class="story" id="story">
            <div class="title">
                <div class="eng" id="titleEng">story</div>
                <div class="chinese" id="titleChn"><i style="color: #e95371;">故事</i>背景</div>
            </div>
            <div class="story-text">
                <p class="idol">『用法・用量を守って正しく透明人間化しましょう！』</p>
                <p class="m-t-30">
                    バーチャルネットアイドルの動画を見ていた主人公・<i class="male">待雪晴季</i>。
                    <br>
                    その配信で突然、視聴者に向けた抽選が行われることに。
                    <br>
                    当選するとその賞品として──
                </p>
                <p class="idol">『な～んでも望みを叶えてあげちゃうスペシャルな権利をプレゼント！』</p>
                <p>
                    とりあえず応募した晴季だったが、結果はなんと当選！
                    <br>
                    アイドル本人からメッセージが届く。
                </p>
                <p class="idol">『今からそちらに行くので、シクヨロ♪』</p>
                <p>
                    すぐに鳴ったチャイムに呼び出されて、玄関に向かうと
                    <br>
                    バーチャルネットアイドル・葛ノ葉チトセ（くずのはちとせ）が待っていた。
                    <br>
                    そこで晴季は謎の薬を手渡される。
                </p>
                <p class="male">「え、えっと、なにこれ……？」</p>
                <p class="idol">「ズバリ！　飲むと透明人間になれちゃうおクスリって寸法よー！　イエイ！」</p>
                <p>
                    <i class="idol">「感想聞かせてね～！」</i>と、満面の笑みで去っていくチトセに途方に暮れる晴季。
                    <br>
                    怪しみながらも早速試してみたところ、本当に鏡に映らない！
                </p>
                <p>
                    そこで、最近ツンツン冷たくされている従姉妹・<i class="female">亜芽</i>あめのお風呂に侵入する。
                    <br>
                    凄まじく美味しそうに育ったその身体を存分に拝見したところ──
                </p>
                <p class="female">「好きです、兄さん」</p>
                <p>
                    そんな告白を聞いてしまい、思わず彼女に触れた瞬間！
                    <br>
                    なんと姿が現れてしまって大変なことに！
                </p>
                <p>
                    しこたま怒られながらもイチャイチャしつつ、
                    <br>
                    彼女と共に用法を確認していくと……
                </p>
                <p>
                    それまで面白いことを求めて過ごしてきた晴季は、これこそが刺激であると大喜び。
                    <br>
                    亜芽は早く真人間に戻さなくてはとおおわらわ！
                </p>
                <p>
                    これは、そんな従姉妹や学園の人々にちょいちょい怒られながらも楽しく過ごす。
                    <br>
                    青春サイキックハートフルストーリーです（！？）
                </p>
            </div>
        </div>

        <!-- 个人简介 -->
        <div class="character">
            <div class="char-nav">123</div>
            <div class="char-content">321</div>
        </div>

        <!-- 背景相关元素 -->
        <div class="site-bg"></div>
        <div class="site-loading" id="loading">
            <ul class="loading-banner">
                <li class="loading-bg loading-01">L</li>
                <li class="loading-bg loading-02">O</li>
                <li class="loading-bg loading-03">A</li>
                <li class="loading-bg loading-04">D</li>
                <li class="loading-bg loading-05">I</li>
                <li class="loading-bg loading-06">N</li>
                <li class="loading-bg loading-07">G</li>
            </ul>
        </div>
    </div>
</body>

<script>
    window.onload = function() {
        // loading
        let loading = document.querySelector('#loading');
        // 单纯人物的bg
        let charImg = document.querySelector('#char');
        // 背景图bg
        let bgImg = document.querySelector('#bg');
        new Promise((resolve) => {
            setTimeout(() => {
                resolve();
            }, 1000)
        }).then(() => {
            // 加载完成后，将loading取消
            loading.classList.add('site-loading-hide');
            // loading动画结束之后
            loading.addEventListener('transitionend', function() {
                // inview展示
                inViewTransition();
                // plate展示
                plateTransition();
                // story展示
                stortyTransition();
                // 纯背景图展示
                charImg.classList.add('show');
            })
            charImg.addEventListener('transitionend', function() {
                bgImg.classList.add('show');
            })
        })

        // 监听滚动条滚动
        window.addEventListener('scroll', () => {
            // inview展示
            inViewTransition();
            // plate展示
            plateTransition();
            // story展示
            stortyTransition();
            // story内容展示
            storyContentTransition();
        })

        // 判断inView出现的时机
        function inViewTransition() {
            let articleInner = document.querySelector('#articleInner');
            // plate数组集合
            let inViewLi = document.querySelectorAll('section.in-view');
            // 当前屏幕高度 + scroll滚动距离 > 当前元素距离顶部距离
            if (document.documentElement.clientHeight + document.documentElement.scrollTop - 15 > articleInner.offsetTop) {
                // 元素中是否存在in-view-show的class
                if (!hasClass(inViewLi[0], 'in-view-show')) {
                    for (let i = 0; i < inViewLi.length; i++) {
                        inViewLi[i].classList.add('in-view-show');
                    }
                }
            } else {
                if (hasClass(inViewLi[0], 'in-view-show')) {
                    for (let i = 0; i < inViewLi.length; i++) {
                        inViewLi[i].classList.remove('in-view-show');
                    }
                }
            }


        }

        // 判断plate出现时机
        function plateTransition() {
            // 获取palte模块
            let plate = document.querySelector('#plate');
            let plateLi = document.querySelectorAll('#plate li');

            let winClientHeight = document.documentElement.clientHeight;
            let winScrollTop = document.documentElement.scrollTop;
            let eleOffsetTop = plate.offsetTop;
            let eleOffsetHeight = plate.offsetHeight;
            const LIMIT = Math.ceil(eleOffsetHeight / 3);

            // 下滑 - 淡入
            if ( (winScrollTop < eleOffsetTop) && (winClientHeight + winScrollTop - LIMIT > eleOffsetTop)) {
                // 元素中是否存在in-view-show的class
                for (let i = 0; i < plateLi.length; i++) {
                    plateLi[i].classList.add('plate-delay');
                    plateLi[i].classList.add('in-view-show');
                    plateLi[i].classList.remove('in-view-hide');
                }  
            }
            // 下滑 - 淡出
            if ((winScrollTop > eleOffsetTop) && (winScrollTop > eleOffsetTop + eleOffsetHeight - LIMIT)) {
                for (let i = 0; i < plateLi.length; i++) {
                    plateLi[i].classList.remove('plate-delay');
                    plateLi[i].classList.remove('in-view-show');
                    plateLi[i].classList.add('in-view-hide');
                }
            }
            // 上滑 - 淡入
            if ((winScrollTop > eleOffsetTop) && (winScrollTop < eleOffsetTop + eleOffsetHeight - LIMIT)) {
                for (let i = 0; i < plateLi.length; i++) {
                    plateLi[i].classList.add('plate-delay');
                    plateLi[i].classList.add('in-view-show');
                    plateLi[i].classList.remove('in-view-hide');
                }
            }
            // 上滑 - 淡出
            if ((winScrollTop < eleOffsetTop) && (winClientHeight + winScrollTop - LIMIT < eleOffsetTop)) {
                for (let i = 0; i < plateLi.length; i++) {
                    plateLi[i].classList.remove('plate-delay');
                    plateLi[i].classList.remove('in-view-show');
                    plateLi[i].classList.add('in-view-hide');
                }
            }
        }

        // 判断story及其content出现时机
        function stortyTransition() {
            let story = getEle('#story');
            // 获取中文title
            lettitleChn = getEle('#titleChn');
            // 获取英文title
            let titleEng = getEle('#titleEng');
            if (document.documentElement.clientHeight + document.documentElement.scrollTop - 15 > story.offsetTop) {
                if (!hasClass(titleChn, 'text-center')) {
                    titleChn.classList.add('text-center');
                    titleEng.classList.add('text-center');
                }
            } else {
                if (hasClass(titleChn, 'text-center')) {
                    titleChn.classList.remove('text-center');
                    titleEng.classList.remove('text-center');
                }
            }
        }

        function storyContentTransition() {
            // 简介content
            let storyText = getEleAll('.story-text > p');
            for(let i = 0; i < storyText.length; i++) {
                storyTextInOut(storyText[i], 'show-block');
            }
        }

        // 控制story模块中元素的淡入淡出
        function storyTextInOut(ele, cla) {

            // 计算滚动条的当前位置
            let screenClientHeight = document.documentElement.clientHeight;
            let scrollTop = document.documentElement.scrollTop;
            let currentHeight = screenClientHeight + scrollTop;
            // 模块在淡出时剩余的高度
            const FADEOUT = 5;
            // 模块在淡入时剩余的高度
            const FADEIN = -5;

            // 向下滑动 - 淡入
            if ( (scrollTop < ele.offsetTop) && currentHeight > ele.offsetTop + FADEOUT) {
                !hasClass(ele, cla) && ele.classList.add(cla);
            }
            // 向下滑动 - 淡出
            if ( (scrollTop > ele.offsetTop) && scrollTop > ele.offsetTop + ele.clientHeight - FADEIN) {
                hasClass(ele, cla) && ele.classList.remove(cla);
            }
            // 向上滑动 - 淡入
            if ( (scrollTop > ele.offsetTop) && scrollTop < ele.offsetTop + ele.clientHeight - FADEOUT) {
                !hasClass(ele, cla) && ele.classList.add(cla);
            }
            // 向上滑动 - 淡出
            if ( (scrollTop < ele.offsetTop) && currentHeight < ele.offsetTop + FADEIN) {
                hasClass(ele, cla) && ele.classList.remove(cla);
            }
        }

        // 获取相应id的元素
        function getEle(id) {
            return document.querySelector(id);
        }

        function getEleAll(ele) {
            return document.querySelectorAll(ele);
        }

        // 检测元素中是否含有某个class
        function hasClass(elem, cls) {
            cls = cls || '';
            if(cls.replace(/\s/g, '').length == 0) return false;
            return new RegExp(' ' + cls + ' ').test(' ' + elem.className + ' ');
        }
    }
</script>
</html>